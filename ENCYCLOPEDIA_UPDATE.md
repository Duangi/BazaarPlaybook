# 更新说明 - 历史页面简化 & 百科搜索功能

## 完成的任务

### ✅ 1. 历史页面简化

**修改文件**: `gui/pages/history_page.py`

**改动内容**:
- 移除了详细的PVP对战记录显示（MatchListItem组件）
- 简化为只显示核心信息的卡片：
  - **结果图标**: 🏆 胜利 / 💀 失败
  - **存活天数**: 以金色高亮显示
  - **开始时间**: 灰色小字
  - **英雄名称**: 灰色小字（如果有）
- 保留左侧边框颜色编码（绿色=胜利，红色=失败）
- 保留刷新按钮和LogAnalyzer集成

**视觉效果**:
```
┌─────────────────────────────────────┐
│ 🏆                 │ 存活天数: 8    │
│ 胜利              │ 开始时间: ...   │
│                   │ 英雄: Pygmalien │
└─────────────────────────────────────┘
```

---

### ✅ 2. 百科搜索页面

**新建文件**: `gui/pages/encyclopedia_page.py`

**功能特性**:

#### 搜索过滤器
1. **关键词搜索**
   - 实时搜索（300ms防抖）
   - 搜索范围：名称（中/英）+ 技能描述

2. **类型筛选**
   - 物品 / 技能 切换按钮
   - 选择技能时自动隐藏尺寸筛选

3. **尺寸筛选**（物品专属）
   - 小 / 中 / 大 三选一
   - 技能类型时自动禁用

4. **品级筛选**
   - 青铜 / 白银 / 黄金 / 钻石 / 传说
   - 每个按钮带对应品级颜色

5. **英雄筛选**
   - 7个英雄头像按钮 + 通用按钮
   - 图标来自 `assets/images/heroes/`

6. **匹配模式**
   - "匹配所有" (AND逻辑)
   - "匹配任一" (OR逻辑)

#### UI功能
- **过滤器折叠**：点击"收起 ▲"按钮可折叠/展开
- **结果统计**：实时显示找到的物品数量
- **清空筛选**：一键重置所有筛选条件
- **结果卡片**：
  - 左侧彩色边框（品级色）
  - 物品图标 + 名称
  - 品级标签（带颜色边框）
  - 最多3个标签显示

#### 样式照抄React版本
- 按钮样式：`toggle-btn` class完全复刻
- 搜索框样式：与React CSS一致
- 英雄头像：圆形边框 + hover效果
- 激活状态：金色高亮 + 阴影效果

---

### ✅ 3. 主窗口集成

**修改文件**: `gui/windows/sidebar_window.py`

**改动内容**:
1. 添加导入：`from gui.pages.encyclopedia_page import EncyclopediaPage`
2. 替换占位符为真实页面：
   ```python
   # 4. 百科搜索页面
   self.encyclopedia_page = EncyclopediaPage()
   self.content_stack.addWidget(self.encyclopedia_page)
   ```

**导航菜单顺序**:
1. 野怪一览 (battle.svg)
2. 卡牌识别 (scanner.svg) - 占位
3. 手头物品 (chest.svg) - 占位
4. **百科搜索** (search.svg) ← 新增真实页面
5. 历史战绩 (history.svg)

---

## 使用说明

### 历史页面
- 启动应用后点击"历史战绩"图标
- 点击"刷新"按钮重新加载日志
- 每个卡片显示一局游戏的简要信息

### 百科搜索页面
1. 启动应用后点击"🔍 百科搜索"图标
2. 在搜索框输入关键词（如"猪"、"伤害"等）
3. 使用过滤器精确定位：
   - 点击"物品"或"技能"筛选类型
   - 点击品级按钮（青铜/白银等）
   - 点击英雄头像筛选专属物品
4. 切换匹配模式（默认"匹配所有"）
5. 点击"清空筛选"重置所有条件
6. 结果会实时更新，左下角显示数量

---

## 技术细节

### 数据源
- 物品数据：`assets/json/items_db.json`
- 英雄头像：`assets/images/heroes/*.webp`

### 性能优化
- 搜索防抖：300ms延迟避免频繁计算
- 结果限制：最多显示50个结果（防止滚动卡顿）
- 按钮状态管理：使用`setProperty("active")`动态更新样式

### 样式系统
- 所有按钮使用统一的`toggle-btn`样式类
- 激活状态：金色边框 + 10%透明金色背景
- Hover效果：金色边框 + 白色文字
- 英雄按钮：圆形头像 + 2px边框

---

## 未来扩展

### 可添加的功能
1. **标签筛选**
   - 多选标签（Drone, Property, Food等）
   - 隐藏标签筛选（Burn, Freeze, Poison等）

2. **详细视图**
   - 点击卡片展开完整技能描述
   - 显示附魔效果
   - 显示冷却时间进阶

3. **排序功能**
   - 按品级排序
   - 按类型排序
   - 按名称排序

4. **收藏系统**
   - 标记常用物品
   - 创建自定义列表

---

## 文件清单

### 新建文件
- `gui/pages/encyclopedia_page.py` (792行)

### 修改文件
- `gui/pages/history_page.py`
  - 简化卡片显示逻辑
  - 移除MatchListItem依赖
  - 添加滚动条样式

- `gui/windows/sidebar_window.py`
  - 添加EncyclopediaPage导入
  - 替换百科搜索占位符

---

## 测试建议

### 历史页面
1. 确保`LogAnalyzer`正常工作
2. 测试"刷新"按钮
3. 验证胜利/失败图标显示正确
4. 检查空状态提示

### 百科搜索页面
1. 测试关键词搜索（中文/英文）
2. 验证类型切换（物品↔技能）
3. 测试尺寸筛选自动隐藏
4. 检查品级/英雄筛选
5. 验证"清空筛选"功能
6. 测试过滤器折叠/展开
7. 检查结果卡片样式（品级颜色）

---

## 已知问题

- 英雄头像路径硬编码（`/images/heroes/`）
- 结果限制为50条（可能需要分页）
- 标签和隐藏标签筛选未实现（需要额外UI空间）

---

## 版本信息

- 更新日期：2024
- 基于：React版本 (App.tsx + App.css)
- PySide6版本：完全照抄React UI设计
